<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ðŸš¦ Smart Vehicle Detection System</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            margin: 0;
            color: #e0e0e0;
        }
        .container {
            padding-top: 20px;
        }
        .main-title {
            font-size: 3.5rem;
            font-weight: 900;
            color: #00d4ff;
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 0 0 20px #00d4ff, 0 0 40px #00d4ff;
            animation: glow 2s ease-in-out infinite alternate;
        }
        @keyframes glow {
            from { text-shadow: 0 0 20px #00d4ff, 0 0 40px #00d4ff; }
            to { text-shadow: 0 0 30px #00d4ff, 0 0 50px #00d4ff, 0 0 70px #00d4ff; }
        }
        .card {
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.05);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(20px);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0,212,255,0.2), transparent);
            transition: left 0.5s;
        }
        .card:hover::before {
            left: 100%;
        }
        .card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.6), 0 0 20px rgba(0,212,255,0.3);
        }
        .upload-box {
            border: 3px dashed #00d4ff;
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            background: rgba(0,212,255,0.05);
            cursor: pointer;
            transition: all 0.4s ease;
            position: relative;
        }
        .upload-box:hover {
            background: rgba(0,212,255,0.1);
            border-color: #00ff88;
            box-shadow: 0 0 30px rgba(0,212,255,0.3);
            transform: translateY(-5px);
        }
        .upload-box i {
            font-size: 3rem;
            color: #00d4ff;
            margin-bottom: 15px;
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        .upload-box h5 {
            font-weight: bold;
            color: #00ff88;
            margin-bottom: 10px;
        }
        .upload-box p {
            color: #b0b0b0;
        }
        .stats-box {
            background: linear-gradient(135deg, rgba(0,212,255,0.1) 0%, rgba(0,255,136,0.1) 100%);
            border: 1px solid rgba(0,212,255,0.3);
            color: #e0e0e0;
            border-radius: 20px;
        }
        .stats-box h5 {
            color: #00d4ff;
            text-shadow: 0 0 10px #00d4ff;
        }
        .stats-box p {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: #c0c0c0;
        }
        .stats-box span {
            font-size: 2.5rem;
            font-weight: bold;
            display: block;
            margin-top: 5px;
            color: #00ff88;
            text-shadow: 0 0 15px #00ff88;
        }
        .btn {
            border-radius: 30px;
            padding: 12px 25px;
            font-weight: bold;
            transition: all 0.3s ease;
            border: 2px solid;
            position: relative;
            overflow: hidden;
        }
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        .btn:hover::before {
            left: 100%;
        }
        .btn-success {
            background: linear-gradient(135deg, #00ff88, #00d4ff);
            border-color: #00ff88;
            color: #000;
            box-shadow: 0 0 20px rgba(0,255,136,0.3);
        }
        .btn-success:hover {
            background: linear-gradient(135deg, #00d4ff, #00ff88);
            transform: translateY(-3px);
            box-shadow: 0 0 30px rgba(0,255,136,0.5);
        }
        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b, #ff4757);
            border-color: #ff6b6b;
            color: #fff;
            box-shadow: 0 0 20px rgba(255,107,107,0.3);
        }
        .btn-danger:hover {
            background: linear-gradient(135deg, #ff4757, #ff6b6b);
            transform: translateY(-3px);
            box-shadow: 0 0 30px rgba(255,107,107,0.5);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: none;
        }
        #videoPreview {
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5), 0 0 20px rgba(0,212,255,0.2);
            transition: all 0.3s ease;
            border: 2px solid rgba(0,212,255,0.3);
        }
        #videoPreview:hover {
            box-shadow: 0 10px 25px rgba(0,0,0,0.7), 0 0 30px rgba(0,212,255,0.4);
            transform: scale(1.01);
        }
        footer {
            margin-top: 50px;
            text-align: center;
            font-size: 1rem;
            color: rgba(255,255,255,0.6);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        .traffic-level {
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            font-weight: bold;
            margin-top: 15px;
            border: 2px solid;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
        }
        .low {
            background: linear-gradient(135deg, rgba(0,255,136,0.2), rgba(0,212,255,0.2));
            border-color: #00ff88;
            color: #00ff88;
            text-shadow: 0 0 10px #00ff88;
        }
        .medium {
            background: linear-gradient(135deg, rgba(255,193,7,0.2), rgba(255,107,107,0.2));
            border-color: #ffc107;
            color: #ffc107;
            text-shadow: 0 0 10px #ffc107;
        }
        .high {
            background: linear-gradient(135deg, rgba(255,107,107,0.2), rgba(220,53,69,0.2));
            border-color: #ff6b6b;
            color: #ff6b6b;
            text-shadow: 0 0 10px #ff6b6b;
        }
        .stats-icon {
            font-size: 1.5rem;
            margin-right: 10px;
        }
    </style>
</head>

<body>

<div class="container mt-4">

    <h2 class="main-title"><i class="fas fa-traffic-light"></i> Smart Vehicle Detection System</h2>

    <!-- UPLOAD SECTION -->
    <div class="card p-4 mb-4">
        <div class="upload-box" onclick="document.getElementById('videoUpload').click()">
            <i class="fas fa-cloud-upload-alt"></i>
            <h5>Click to Upload Video</h5>
            <p>Select a traffic footage video to analyze</p>
            <input type="file" id="videoUpload" class="form-control mt-2" accept="video/*" style="display:none;">
        </div>
    </div>

    <div class="row g-4">

        <!-- VIDEO PREVIEW -->
        <div class="col-lg-8 col-md-7 col-sm-12">
            <div class="card p-3">
                <h5 class="fw-bold mb-3"><i class="fas fa-video"></i> Live YOLO Detection Preview</h5>
                <img id="videoPreview" src="" style="width:100%; border-radius:10px;">
                <div class="mt-3 text-center">
                    <button id="startBtn" class="btn btn-success me-2" onclick="startProcessing()" disabled><i class="fas fa-play"></i> Start Analysis</button>
                    <button id="stopBtn" class="btn btn-danger" onclick="stopProcessing()" disabled><i class="fas fa-stop"></i> Stop Analysis</button>
                </div>
            </div>
        </div>

        <!-- ANALYTICS SECTION -->
        <div class="col-lg-4 col-md-5 col-sm-12">
            <div class="card p-4 stats-box">
                <h5 class="fw-bold mb-3"><i class="fas fa-chart-bar"></i> Real-Time Analytics</h5>

                <p><i class="fas fa-car stats-icon"></i>Vehicle Count:  
                    <span id="vehicleCount" class="fw-bold">0</span>
                </p>

                <p><i class="fas fa-traffic-light stats-icon"></i>Traffic Cluster Level:  
                    <span id="clusterLevel" class="fw-bold">-</span>
                </p>

                <div id="trafficIndicator" class="traffic-level" style="display: none;">
                    <span id="trafficText">-</span>
                </div>
            </div>
        </div>

    </div>
</div>

<footer>
    <i class="fas fa-copyright"></i> 2025 Smart Traffic AI System | Powered by YOLOv8 & <i class="fas fa-brain"></i>
</footer>


<script>
// Upload video â†’ send to backend
document.getElementById('videoUpload').addEventListener('change', function(e) {
    let file = e.target.files[0];
    let formData = new FormData();
    formData.append("video", file);

    fetch("/upload_video", {
        method: "POST",
        body: formData
    }).then(() => {
        // Enable start button after upload
        document.getElementById("startBtn").disabled = false;
        alert("Video uploaded successfully! Click 'Start Analysis' to begin.");
    });
});

// Start processing
function startProcessing() {
    fetch("/start_processing")
        .then(r => r.json())
        .then(d => {
            if (d.status === "started") {
                document.getElementById("videoPreview").src = "/video_feed";
                document.getElementById("startBtn").disabled = true;
                document.getElementById("stopBtn").disabled = false;
            }
        });
}

// Stop processing
function stopProcessing() {
    fetch("/stop_processing")
        .then(r => r.json())
        .then(d => {
            if (d.status === "stopped") {
                document.getElementById("videoPreview").src = "";
                document.getElementById("startBtn").disabled = false;
                document.getElementById("stopBtn").disabled = true;
            }
        });
}

// Update vehicle count every 300ms
setInterval(() => {
    fetch("/get_count")
        .then(r => r.json())
        .then(d => document.getElementById("vehicleCount").innerHTML = d.count);
}, 300);

// Update cluster level every 500ms
setInterval(() => {
    fetch("/get_cluster")
        .then(r => r.json())
        .then(d => {
            document.getElementById("clusterLevel").innerHTML = d.cluster;
            const indicator = document.getElementById("trafficIndicator");
            const text = document.getElementById("trafficText");
            if (d.cluster !== "Waiting...") {
                indicator.style.display = "block";
                text.innerHTML = d.cluster;
                let className = "traffic-level ";
                if (d.cluster.includes("Low")) className += "low";
                else if (d.cluster.includes("Medium")) className += "medium";
                else if (d.cluster.includes("High")) className += "high";
                indicator.className = className;
            } else {
                indicator.style.display = "none";
            }
        });
}, 500);
</script>

</body>
</html>

